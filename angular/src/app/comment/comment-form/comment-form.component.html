<div class="comment-form-container">
  <h3>Add Comment</h3>

  <form class="comment-form" [formGroup]="commentForm" (ngSubmit)="onSubmit()">
    <div class="form-row">
      <div class="form-group">
        <label for="userName">User Name *</label>
        <input type="text"
               id="userName"
               class="form-control"
               formControlName="userName"
               [attr.disabled]="isSubmitting ? true : null"
               autofocus
               placeholder="Your name">
        <div *ngIf="commentForm.get('userName')?.invalid && commentForm.get('userName')?.touched" class="error-message">
          Name is required
        </div>
      </div>

      <div class="form-group">
        <label for="email">Email *</label>
        <input type="email"
               id="email"
               class="form-control"
               formControlName="email"
               [attr.disabled]="isSubmitting ? true : null"
               placeholder="Your email">
        <div *ngIf="commentForm.get('email')?.invalid && commentForm.get('email')?.touched" class="error-message">
          Valid email is required
        </div>
      </div>

      <div class="form-group">
        <label for="homepage">Homepage</label>
        <input type="url"
               id="homepage"
               class="form-control"
               formControlName="homepage"
               [attr.disabled]="isSubmitting ? true : null"
               placeholder="Your website (optional)">
        <div *ngIf="commentForm.get('homepage')?.invalid && commentForm.get('homepage')?.touched" class="error-message">
          Please enter a valid URL
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="text">Comment *</label>
      <textarea id="text"
                class="form-control"
                rows="5"
                formControlName="text"
                [attr.disabled]="isSubmitting ? true : null"
                placeholder="Your comment"></textarea>
      <div *ngIf="commentForm.get('text')?.invalid && commentForm.get('text')?.touched" class="error-message">
        Comment text is required
      </div>
    </div>

    <div class="form-group">
      <label>File Attachment</label>
      <div class="file-upload">
        <input type="file"
               id="file"
               #fileInput
               (change)="onFileSelected($event)"
               [attr.disabled]="isSubmitting ? true : null"
               style="display: none">
        <button type="button" class="btn-file" (click)="fileInput.click()" [attr.disabled]="isSubmitting ? true : null">
          üìé Choose File
        </button>
        <span class="file-name">{{ fileName || 'No file chosen' }}</span>
      </div>
    </div>

    <div class="form-group">
      <label>CAPTCHA *</label>
      <div class="captcha-section">
        <p>CAPTCHA: What is 2 + 3?</p>
        <input type="text"
               class="form-control"
               formControlName="captcha"
               placeholder="Enter answer"
               [attr.disabled]="isSubmitting ? true : null">
        <div *ngIf="commentForm.get('captcha')?.invalid && commentForm.get('captcha')?.touched" class="error-message">
          CAPTCHA is required
        </div>
        <small style="color: #6c757d; font-size: 12px;">Answer: 5 (temporary)</small>
      </div>
    </div>

    <div class="form-actions text-end">
      <button type="button" class="btn-preview me-2" (click)="togglePreview()" [attr.disabled]="isSubmitting ? true : null">
        {{ showPreview ? 'Hide Preview' : 'Show Preview' }}
      </button>
      <button type="submit" class="btn-submit" [disabled]="commentForm.invalid || isSubmitting">
        <span *ngIf="!isSubmitting">‚úì</span>
        <span *ngIf="isSubmitting">‚è≥</span>
        {{ isSubmitting ? 'Submitting...' : 'Submit Comment' }}
      </button>
    </div>
  </form>

  <!-- Preview Section -->
  <div *ngIf="showPreview && commentForm.valid" class="preview-section mt-3">
    <h4>Preview</h4>
    <div class="preview-content card">
      <div class="card-body">
        <strong>{{ commentForm.get('userName')?.value || 'Anonymous' }}</strong>
        <p class="mt-2">{{ commentForm.get('text')?.value }}</p>
      </div>
    </div>
  </div>
</div>
