<div class="comment-form-container">
  <h3>{{ '::AddComment' | abpLocalization }}</h3>

  <form class="comment-form" [formGroup]="commentForm" (ngSubmit)="onSubmit()">
    <div class="form-row">
      <div class="form-group">
        <label for="userName">{{ '::UserName' | abpLocalization }} *</label>
        <input type="text"
               id="userName"
               class="form-control"
               formControlName="userName"
               [attr.disabled]="isSubmitting ? true : null"
               autofocus>
        <div *ngIf="commentForm.get('userName')?.invalid && commentForm.get('userName')?.touched" class="error-message">
          {{ '::UserNameRequired' | abpLocalization }}
        </div>
      </div>

      <div class="form-group">
        <label for="email">{{ '::Email' | abpLocalization }} *</label>
        <input type="email"
               id="email"
               class="form-control"
               formControlName="email"
               [attr.disabled]="isSubmitting ? true : null">
        <div *ngIf="commentForm.get('email')?.invalid && commentForm.get('email')?.touched" class="error-message">
          {{ '::ValidEmailRequired' | abpLocalization }}
        </div>
      </div>

      <div class="form-group">
        <label for="homepage">{{ '::Homepage' | abpLocalization }}</label>
        <input type="url"
               id="homepage"
               class="form-control"
               formControlName="homepage"
               [attr.disabled]="isSubmitting ? true : null">
        <div *ngIf="commentForm.get('homepage')?.invalid && commentForm.get('homepage')?.touched" class="error-message">
          {{ '::ValidUrlRequired' | abpLocalization }}
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="text">{{ '::Text' | abpLocalization }} *</label>
      <textarea id="text"
                class="form-control"
                rows="5"
                formControlName="text"
                [attr.disabled]="isSubmitting ? true : null"></textarea>
      <div *ngIf="commentForm.get('text')?.invalid && commentForm.get('text')?.touched" class="error-message">
        {{ '::CommentTextRequired' | abpLocalization }}
      </div>
    </div>

    <div class="form-group">
      <label>{{ '::FileAttachment' | abpLocalization }}</label>
      <div class="file-upload">
        <input type="file"
               id="file"
               #fileInput
               (change)="onFileSelected($event)"
               [attr.disabled]="isSubmitting ? true : null"
               style="display: none">
        <button type="button" class="btn btn-secondary" (click)="fileInput.click()" [attr.disabled]="isSubmitting ? true : null">
          <i class="fa fa-paperclip me-1"></i>
          {{ '::ChooseFile' | abpLocalization }}
        </button>
        <span class="file-name ms-2" id="fileName">{{ '::NoFileChosen' | abpLocalization }}</span>
      </div>
    </div>

    <div class="form-group">
      <label>{{ '::Captcha' | abpLocalization }} *</label>
      <div class="captcha-section">
        <app-captcha></app-captcha>
        <input type="text"
               class="form-control mt-2"
               formControlName="captcha"
               [placeholder]="'::EnterCaptcha' | abpLocalization"
               [attr.disabled]="isSubmitting ? true : null">
        <div *ngIf="commentForm.get('captcha')?.invalid && commentForm.get('captcha')?.touched" class="error-message">
          {{ '::CaptchaRequired' | abpLocalization }}
        </div>
      </div>
    </div>

    <div class="form-actions text-end">
      <button type="button" class="btn btn-outline-secondary me-2" (click)="togglePreview()" [attr.disabled]="isSubmitting ? true : null">
        {{ (showPreview ? '::HidePreview' : '::ShowPreview') | abpLocalization }}
      </button>
      <button type="submit" class="btn btn-primary" [disabled]="commentForm.invalid || isSubmitting">
        <i class="fa fa-check me-1" *ngIf="!isSubmitting"></i>
        <i class="fa fa-spinner fa-spin me-1" *ngIf="isSubmitting"></i>
        {{ (isSubmitting ? '::Submitting' : '::SubmitComment') | abpLocalization }}
      </button>
    </div>
  </form>

  <!-- Preview Section -->
  <div *ngIf="showPreview && commentForm.valid" class="preview-section mt-3">
    <h4>{{ '::Preview' | abpLocalization }}</h4>
    <div class="preview-content card">
      <div class="card-body">
        <strong>{{ commentForm.get('userName')?.value || ('::Anonymous' | abpLocalization) }}</strong>
        <p class="mt-2">{{ commentForm.get('text')?.value }}</p>
      </div>
    </div>
  </div>
</div>
