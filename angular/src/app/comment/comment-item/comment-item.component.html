<div class="comment-item level-{{level}}">
  <div class="comment-content">
    <div class="comment-header">
      <div class="user-info">
        <strong class="comment-author">{{comment.userName}}</strong>
        <span class="comment-email">{{comment.email}}</span>
      </div>
      <span class="comment-date">{{comment.creationTime | date:'dd.MM.yy Ğ² HH:mm'}}</span>
    </div>

    <div class="comment-text">{{comment.text}}</div>

    <div *ngIf="hasFile(comment)" class="comment-file">
      <div class="file-attachment" [class.uploaded]="comment.fileId">
        <span class="file-icon">
          {{ getFileType(comment) === 'image' ? 'ğŸ–¼ï¸' : 'ğŸ“„' }}
        </span>
        <span class="file-name">{{ comment.fileName || 'Attached file' }}</span>
        <span *ngIf="comment.fileSize" class="file-size">
          ({{ formatFileSize(comment.fileSize) }})
        </span>
        <span class="file-type-badge">{{ getFileType(comment) }}</span>
        <button class="btn-view-file" (click)="viewFile(comment)">
          ğŸ‘ï¸ {{ getFileType(comment) === 'image' ? 'View Image' : 'View Text' }}
        </button>
      </div>
    </div>

    <button class="btn-reply-small" (click)="onShowReplyForm(comment.id)">
      {{ isReplyingTo(comment.id) ? 'Cancel' : 'Reply' }}
    </button>

    <div *ngIf="isReplyingTo(comment.id)" class="reply-form-small">
      <div class="form-group">
        <input type="text"
               [value]="getReplyUserName(comment.id)"
               (input)="onSetReplyUserName(comment.id, $any($event.target).value)"
               placeholder="Your name (optional)"
               class="form-control">
      </div>
      <div class="form-group">
        <textarea [value]="getReplyText(comment.id)"
                  (input)="onSetReplyText(comment.id, $any($event.target).value)"
                  placeholder="Write your reply..."
                  rows="2"
                  class="form-control"></textarea>
      </div>
      <div class="form-actions">
        <button (click)="onSubmitReply(comment.id)"
                [disabled]="!getReplyText(comment.id)?.trim()"
                class="btn-submit">
          Submit Reply
        </button>
        <button (click)="onCancelReply(comment.id)" class="btn-cancel">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="comment.hasReplies" class="nested-replies">
    <div *ngIf="comment.repliesLoaded && comment.replies && comment.replies.length > 0" class="replies-list">
      <app-comment-item *ngFor="let nestedReply of comment.replies; trackBy: trackByCommentId"
                        [comment]="nestedReply"
                        [level]="level + 1"
                        [showReplyFormFor]="showReplyFormFor"
                        [replyTexts]="replyTexts"
                        [replyUserNames]="replyUserNames"
                        (showReply)="showReply.emit($event)"
                        (setReplyText)="setReplyText.emit($event)"
                        (setReplyUserName)="setReplyUserName.emit($event)"
                        (submitReply)="submitReply.emit($event)"
                        (cancelReply)="cancelReply.emit($event)"
                        (loadReplies)="loadReplies.emit($event)">
      </app-comment-item>
    </div>

    <button *ngIf="!comment.repliesLoaded && comment.repliesCount > 0"
            (click)="onLoadReplies(comment)"
            class="btn-load-replies">
      Load Replies ({{comment.repliesCount}})
    </button>
  </div>
</div>
